This file contains troublshooting steps to solve the issue of " VM Agent Not Ready " 

What is Azure VM Agent : 
------------------------

The Microsoft Azure Virtual Machine Agent (VM Agent) is a secure, lightweight process that manages virtual machine (VM) interaction with the Azure Fabric Controller. The VM Agent has a primary role in enabling and executing Azure virtual machine extensions. VM Extensions enable post-deployment configuration of VM, such as installing and configuring software. VM extensions also enable recovery features such as resetting the administrative password of a VM. Without the Azure VM Agent, VM extensions cannot be run
To remove VM Agent
 
Impact : 
--------

> when the VM agent is in "Not Ready" state that will cause an issue with backup , extensions , administrative operations as mentioned above.

Troubleshooting Steps : 
-----------------------

> I've followed all the steps mentioned in the offical documentation but it doesn't solve the issue in my case and while i was trying to install the agent in offline mode i faced an error : "Object doesn't support this property or method : 'Me.Script'"
-----------------------------------------------------------------------------------------------------------------------------------------------------------------
On the affected machine: 
-----------------------

> Stop "Windows Azure Guest Agent" if it was running

> Export then delete those registry in the path : 

Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services\WindowsAzureGuestAgent
Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services\rdagent

> Backup then Remove

C:\Windows\OEM\        "delete the conent of the OEM folder , don't delete the folder itself" 
C:\Windows Azure       "delete the folder , and if it can't be deleted because it's used by the service you can restart the machine and then try to delete it again or rename it"

> Open CMD as Admin and delete the service

SC Delete "WindowsAzureGuestAgent"
 
Restart the server and check that the service deleted succesfully .
----------------------------------------------------------------------------------------------------------------
Now go to any other machine that the agent is working normally on and do the following : 

Export the below registry : 

	• Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services\WindowsAzureGuestAgent
	• Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services\rdagent
From a working VM
 
Then we need to create a service for Guest Agent:
 
Copy the path in registry file
Computer\HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services\WindowsAzureGuestAgent\ImagePath
 
New-Service -Name "YourServiceName" -BinaryPathName <yourproject>.exe
New-Service -Name "WindowsAzureGuestAgent" -BinaryPathName C:\WindowsAzure\Packages\GuestAgent\WindowsAzureGuestAgent.exe

=======
This file contains troublshooting steps to solve the issue of " VM extension Not Ready " 
>>>>>>> 83deca72fb3120551aacecee782621e44e83f650
